---
description: "项目计划管理规范"
globs: ["docs/plans/**/*.md"]
alwaysApply: false
---

# 项目计划管理规范

## 计划目录结构

```
docs/plans/
├── README.md                    # 计划索引，列出所有计划及其状态
├── plan-name-1.md              # 具体计划文档
└── plan-name-2.md              # 具体计划文档
```

## 计划文档模板

每个计划文档应包含以下部分：

```markdown
# [计划标题]

## 状态
📝 计划中 | 🚧 进行中 | ✅ 已完成 | ❌ 已取消

## 问题分析
描述当前存在的问题或改进机会

## 解决方案
提出的技术方案和设计思路

## 实施步骤
1. [ ] 待办事项 1
2. [ ] 待办事项 2
3. [ ] 待办事项 3

## 风险评估
列出可能的风险和应对措施

## 验证清单
- [ ] 验证项 1
- [ ] 验证项 2

## 备注
其他需要记录的信息
```

## 计划状态管理

### 状态定义
- **📝 计划中**：方案设计阶段，未开始实施
- **🚧 进行中**：正在实施
- **✅ 已完成**：已完成实施，等待清理文档
- **❌ 已取消**：计划不再执行

### 状态流转
```
📝 计划中 → 🚧 进行中 → ✅ 已完成 → [清理文档]
                  ↓
                 ❌ 已取消
```

## 计划完成后处理

### ⚠️ 重要：计划完成后必须清理

当计划状态变为 **✅ 已完成** 时，必须执行以下清理操作：

1. **检查是否需要保留设计文档**
   - 如果方案具有长期参考价值 → 移至 `docs/designs/`
   - 如果是一次性改造 → 删除计划文档

2. **更新 README.md**
   - 将已完成的计划移到"已完成计划"部分
   - 或直接从 README.md 中删除

3. **归档或删除**
   - 有价值的计划：移动到 `docs/plans/archive/`
   - 无价值的计划：直接删除

### 清理流程

#### 情况 1：移至设计文档（推荐）
如果计划包含重要的设计决策，值得长期参考：

```bash
# 1. 将计划文档转换为设计文档
mv docs/plans/feature-name.md docs/designs/feature-name.md

# 2. 更新设计文档格式
# - 移除实施步骤和验证清单
# - 保留问题分析、解决方案、技术细节
# - 添加参考代码示例

# 3. 创建对应的 cursor 规则引用
# 在 .cursor/rules/ 中创建规则，指向设计文档
```

#### 情况 2：归档
如果计划可能在未来有参考价值，但不是核心设计：

```bash
# 1. 创建归档目录（如果不存在）
mkdir -p docs/plans/archive

# 2. 移动到归档
mv docs/plans/feature-name.md docs/plans/archive/feature-name.md

# 3. 在归档文档顶部添加完成日期
+++
完成日期：2025-01-15
+++
```

#### 情况 3：删除
如果是一次性的代码清理或重构，不需要保留：

```bash
# 直接删除计划文档
rm docs/plans/feature-name.md

# 从 README.md 中移除
```

## 计划文档引用

在代码中引用计划时，使用相对路径：

```typescript
/**
 * 用户认证服务
 *
 * 实现方案详见：docs/plans/oauth2-refactor.md
 */
```

## Cursor 规则联动

计划完成后，相关的 Cursor 规则可能需要更新：

1. **如果涉及架构变更**
   - 更新 `directory-structure.mdc`
   - 更新 `project-overview.mdc`

2. **如果涉及技术栈变更**
   - 更新 `project-overview.mdc`
   - 更新相关的技术规范

3. **如果引入新的开发模式**
   - 创建新的规则文件
   - 在 `CLAUDE.md` 中添加引用

## 示例

### 示例 1：有价值的计划 → 移至设计文档

**计划阶段**：`docs/plans/vector-search.md`
- 实施步骤清晰
- 包含技术细节
- 完成后仍需参考

**完成后**：
```bash
# 转换为设计文档
mv docs/plans/vector-search.md docs/designs/vector-search.md

# 编辑设计文档，移除待办事项，保留技术细节

# 创建规则引用
# .cursor/rules/vector-search.mdc 中引用：
# "详见：docs/designs/vector-search.md"
```

### 示例 2：一次性重构 → 删除

**计划阶段**：`docs/plans/refactor-api-error-handling.md`
- 简单的重构任务
- 无复杂设计决策

**完成后**：
```bash
# 直接删除
rm docs/plans/refactor-api-error-handling.md

# 从 README.md 中移除
```

## 注意事项

⚠️ **关键原则**：
- **计划 ≠ 设计文档**：计划是临时的，设计文档是长期的
- **及时清理**：计划完成后立即处理，避免积累
- **价值判断**：只保留有长期参考价值的文档
- **更新索引**：清理后务必更新 `docs/plans/README.md`

❌ **不要做的事**：
- 让已完成的计划长期停留在 `docs/plans/`
- 在计划文档中保留已完成的待办事项
- 忘记更新 README.md 索引
- 保留毫无参考价值的计划文档

✅ **应该做的事**：
- 计划完成时立即判断保留价值
- 将重要设计移至 `docs/designs/`
- 及时删除或归档无价值文档
- 保持 `docs/plans/` 的整洁性
