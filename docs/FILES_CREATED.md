# ğŸ“¦ Docker è‡ªåŠ¨åŒ–éƒ¨ç½² - æ–‡ä»¶æ¸…å•

æœ¬æ–‡æ¡£åˆ—å‡ºäº†ä¸ºå®ç° Docker è‡ªåŠ¨åŒ–éƒ¨ç½²æ‰€åˆ›å»ºçš„æ‰€æœ‰æ–‡ä»¶ã€‚

## âœ… å·²åˆ›å»ºçš„æ–‡ä»¶

### 1. GitHub Actions å·¥ä½œæµ

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | åŠŸèƒ½ |
|---------|------|------|
| `.github/workflows/docker-release.yml` | Docker å‘å¸ƒå·¥ä½œæµ | å½“æ¨é€åˆ° release åˆ†æ”¯æ—¶è‡ªåŠ¨æ„å»ºå¹¶æ¨é€é•œåƒåˆ° DockerHub |
| `.github/workflows/docker-pr-check.yml` | PR æ£€æŸ¥å·¥ä½œæµ | PR åˆ° release åˆ†æ”¯æ—¶è¿›è¡Œ Docker æ„å»ºæµ‹è¯• |
| `.github/PULL_REQUEST_TEMPLATE.md` | PR æ¨¡æ¿ | è§„èŒƒåŒ– Pull Request æ ¼å¼ |

### 2. Docker é…ç½®æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | ç”¨é€” |
|---------|------|------|
| `Dockerfile` | å¼€å‘ç¯å¢ƒ Dockerfile | æœ¬åœ°å¼€å‘å’Œæµ‹è¯• |
| `Dockerfile.prod` | ç”Ÿäº§ç¯å¢ƒ Dockerfile | GitHub Actions æ„å»ºï¼Œå¤šé˜¶æ®µæ„å»ºä¼˜åŒ– |
| `docker-compose.yml` | å¼€å‘ç¯å¢ƒ Compose | æœ¬åœ° Docker å¼€å‘ |
| `docker-compose.prod.yml` | ç”Ÿäº§ç¯å¢ƒ Compose | ä» DockerHub æ‹‰å–é•œåƒéƒ¨ç½² |
| `docker-entrypoint.sh` | å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬ | å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œ |
| `docker-entrypoint-prod.sh` | ç”Ÿäº§ç¯å¢ƒå¯åŠ¨è„šæœ¬ | ç”Ÿäº§å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œ |

### 3. éƒ¨ç½²è„šæœ¬

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | åŠŸèƒ½ |
|---------|------|------|
| `scripts/deploy.sh` | å¿«é€Ÿéƒ¨ç½²è„šæœ¬ | ä¸€é”®éƒ¨ç½²ã€æ›´æ–°ã€å›æ»šç­‰æ“ä½œ |
| `scripts/setup-secrets.sh` | é…ç½®åŠ©æ‰‹è„šæœ¬ | å¼•å¯¼é…ç½® GitHub Secrets |

### 4. API ç«¯ç‚¹

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | åŠŸèƒ½ |
|---------|------|------|
| `src/app/api/health/route.ts` | å¥åº·æ£€æŸ¥ API | ç”¨äº Docker å¥åº·æ£€æŸ¥å’ŒæœåŠ¡ç›‘æ§ |

### 5. æ–‡æ¡£

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | å†…å®¹ |
|---------|------|------|
| `docs/DOCKER_DEPLOYMENT.md` | å®Œæ•´éƒ¨ç½²æŒ‡å— | è¯¦ç»†çš„é…ç½®å’Œéƒ¨ç½²è¯´æ˜ |
| `docs/QUICK_START.md` | å¿«é€Ÿå¼€å§‹æŒ‡å— | 5 åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²æ•™ç¨‹ |
| `docs/FILES_CREATED.md` | æ–‡ä»¶æ¸…å•ï¼ˆæœ¬æ–‡æ¡£ï¼‰ | åˆ—å‡ºæ‰€æœ‰åˆ›å»ºçš„æ–‡ä»¶ |

### 6. é…ç½®æ–‡ä»¶æ›´æ–°

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ |
|---------|---------|
| `README.md` | æ·»åŠ  Docker éƒ¨ç½²ç« èŠ‚ |
| `.env.example` | æ·»åŠ  Docker å’Œ COS é…ç½®è¯´æ˜ |

## ğŸ“ å®Œæ•´æ–‡ä»¶æ ‘

```
react.nnnnzs.cn/
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ docker-release.yml          # âœ¨ æ–°å¢ï¼šè‡ªåŠ¨å‘å¸ƒå·¥ä½œæµ
â”‚   â”‚   â””â”€â”€ docker-pr-check.yml         # âœ¨ æ–°å¢ï¼šPR æ£€æŸ¥å·¥ä½œæµ
â”‚   â””â”€â”€ PULL_REQUEST_TEMPLATE.md        # âœ¨ æ–°å¢ï¼šPR æ¨¡æ¿
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ DOCKER_DEPLOYMENT.md            # âœ¨ æ–°å¢ï¼šå®Œæ•´éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ QUICK_START.md                  # âœ¨ æ–°å¢ï¼šå¿«é€Ÿå¼€å§‹æŒ‡å—
â”‚   â””â”€â”€ FILES_CREATED.md                # âœ¨ æ–°å¢ï¼šæ–‡ä»¶æ¸…å•
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deploy.sh                       # âœ¨ æ–°å¢ï¼šéƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ setup-secrets.sh                # âœ¨ æ–°å¢ï¼šé…ç½®åŠ©æ‰‹
â”œâ”€â”€ src/
â”‚   â””â”€â”€ app/
â”‚       â””â”€â”€ api/
â”‚           â””â”€â”€ health/
â”‚               â””â”€â”€ route.ts            # âœ¨ æ–°å¢ï¼šå¥åº·æ£€æŸ¥ API
â”œâ”€â”€ Dockerfile                          # ç°æœ‰ï¼šå¼€å‘ç¯å¢ƒ
â”œâ”€â”€ Dockerfile.prod                     # âœ¨ æ–°å¢ï¼šç”Ÿäº§ç¯å¢ƒï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰
â”œâ”€â”€ docker-compose.yml                  # ç°æœ‰ï¼šå¼€å‘ç¯å¢ƒ
â”œâ”€â”€ docker-compose.prod.yml             # âœ¨ æ–°å¢ï¼šç”Ÿäº§ç¯å¢ƒ
â”œâ”€â”€ docker-entrypoint.sh                # ç°æœ‰ï¼šå¼€å‘å¯åŠ¨è„šæœ¬
â”œâ”€â”€ docker-entrypoint-prod.sh           # âœ¨ æ–°å¢ï¼šç”Ÿäº§å¯åŠ¨è„šæœ¬
â”œâ”€â”€ .env.example                        # ğŸ”„ æ›´æ–°ï¼šæ·»åŠ é…ç½®è¯´æ˜
â””â”€â”€ README.md                           # ğŸ”„ æ›´æ–°ï¼šæ·»åŠ  Docker ç« èŠ‚
```

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. é…ç½® GitHub Secretsï¼ˆå¿…éœ€ï¼‰

```bash
# ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰
./scripts/setup-secrets.sh

# æˆ–æ‰‹åŠ¨é…ç½®ï¼š
# è®¿é—®: https://github.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“/settings/secrets/actions
# æ·»åŠ  DOCKERHUB_USERNAME å’Œ DOCKERHUB_TOKEN
```

### 2. æ¨é€åˆ° release åˆ†æ”¯

```bash
# åˆ›å»º release åˆ†æ”¯
git checkout -b release

# æäº¤æ‰€æœ‰æ–°æ–‡ä»¶
git add .
git commit -m "feat: æ·»åŠ  Docker è‡ªåŠ¨åŒ–éƒ¨ç½²æ”¯æŒ"

# æ¨é€åˆ°è¿œç¨‹
git push origin release
```

### 3. éªŒè¯è‡ªåŠ¨æ„å»º

1. è®¿é—® `https://github.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“/actions`
2. æŸ¥çœ‹ "Docker Release" å·¥ä½œæµæ˜¯å¦æˆåŠŸè¿è¡Œ
3. æ£€æŸ¥ DockerHub æ˜¯å¦æœ‰æ–°çš„é•œåƒ

### 4. åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²

```bash
# å…‹éš†ä»“åº“ï¼ˆæˆ–æ‹‰å–æœ€æ–°ä»£ç ï¼‰
git clone https://github.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“.git
cd ä½ çš„ä»“åº“

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env  # ä¿®æ”¹æ•°æ®åº“ã€Redis ç­‰é…ç½®

# ä¿®æ”¹ docker-compose.prod.yml ä¸­çš„é•œåƒåç§°
# æˆ–è®¾ç½®ç¯å¢ƒå˜é‡
export DOCKERHUB_USERNAME=ä½ çš„dockerhubç”¨æˆ·å

# è¿è¡Œéƒ¨ç½²
./scripts/deploy.sh deploy

# æŸ¥çœ‹æ—¥å¿—
./scripts/deploy.sh logs
```

## ğŸ“‹ é…ç½®æ£€æŸ¥æ¸…å•

åœ¨æ¨é€åˆ° release åˆ†æ”¯ä¹‹å‰ï¼Œè¯·ç¡®ä¿ï¼š

- [ ] å·²æ³¨å†Œ DockerHub è´¦å·
- [ ] å·²åˆ›å»º DockerHub Access Token
- [ ] å·²åœ¨ GitHub è®¾ç½® Secretsï¼ˆDOCKERHUB_USERNAME å’Œ DOCKERHUB_TOKENï¼‰
- [ ] å·²å°†æ‰€æœ‰æ–°æ–‡ä»¶æ·»åŠ åˆ° Git
- [ ] å·²æµ‹è¯•æœ¬åœ° Docker æ„å»ºï¼ˆå¯é€‰ï¼‰
- [ ] å·²æ›´æ–° .env æ–‡ä»¶ï¼ˆç”Ÿäº§æœåŠ¡å™¨ï¼‰

## ğŸ”§ æœ¬åœ°æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

åœ¨æ¨é€åˆ° GitHub ä¹‹å‰ï¼Œå¯ä»¥åœ¨æœ¬åœ°æµ‹è¯• Docker æ„å»ºï¼š

```bash
# æµ‹è¯•ç”Ÿäº§ç¯å¢ƒ Dockerfile æ„å»º
docker build -f Dockerfile.prod -t react-nnnnzs-cn:test .

# è¿è¡Œæµ‹è¯•å®¹å™¨
docker run -d \
  --name react-nnnnzs-cn-test \
  -p 3301:3301 \
  --env-file .env \
  react-nnnnzs-cn:test

# æŸ¥çœ‹æ—¥å¿—
docker logs -f react-nnnnzs-cn-test

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:3301/api/health

# æ¸…ç†æµ‹è¯•å®¹å™¨
docker stop react-nnnnzs-cn-test
docker rm react-nnnnzs-cn-test
docker rmi react-nnnnzs-cn:test
```

## ğŸ“Š å·¥ä½œæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¼€å‘æµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æœ¬åœ°å¼€å‘å’Œæµ‹è¯•                                       â”‚
â”‚     git commit -m "feat: æ–°åŠŸèƒ½"                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. æ¨é€åˆ° release åˆ†æ”¯                                  â”‚
â”‚     git push origin release                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. GitHub Actions è‡ªåŠ¨è§¦å‘                              â”‚
â”‚     â”œâ”€ æ£€å‡ºä»£ç                                          â”‚
â”‚     â”œâ”€ ç”Ÿæˆç‰ˆæœ¬å·                                       â”‚
â”‚     â”œâ”€ æ„å»º Docker é•œåƒ                                 â”‚
â”‚     â””â”€ æ¨é€åˆ° DockerHub                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²                                       â”‚
â”‚     ./scripts/deploy.sh deploy                          â”‚
â”‚     â”œâ”€ æ‹‰å–æœ€æ–°é•œåƒ                                     â”‚
â”‚     â”œâ”€ åœæ­¢æ—§å®¹å™¨                                       â”‚
â”‚     â”œâ”€ å¯åŠ¨æ–°å®¹å™¨                                       â”‚
â”‚     â””â”€ å¥åº·æ£€æŸ¥                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. åº”ç”¨è¿è¡Œä¸­                                           â”‚
â”‚     ç›‘æ§æ—¥å¿—ã€æ€§èƒ½ã€é”™è¯¯                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

æœ¬æ¬¡æ·»åŠ çš„ Docker è‡ªåŠ¨åŒ–éƒ¨ç½²æ–¹æ¡ˆæä¾›ï¼š

### âœ… è‡ªåŠ¨åŒ–

- âœ… æ¨é€ä»£ç è‡ªåŠ¨è§¦å‘æ„å»º
- âœ… è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å·
- âœ… è‡ªåŠ¨æ¨é€åˆ° DockerHub
- âœ… æ”¯æŒ amd64 å¹³å°æ„å»º

### âœ… ç‰ˆæœ¬ç®¡ç†

- âœ… æ”¯æŒè¯­ä¹‰åŒ–ç‰ˆæœ¬æ ‡ç­¾ï¼ˆv1.0.0ï¼‰
- âœ… è‡ªåŠ¨ç”Ÿæˆæ—¥æœŸç‰ˆæœ¬ï¼ˆv2024.11.28-abc1234ï¼‰
- âœ… åŒæ—¶ç»´æŠ¤ latest å’Œç‰ˆæœ¬æ ‡ç­¾
- âœ… æ”¯æŒå¿«é€Ÿå›æ»š

### âœ… ç”Ÿäº§ä¼˜åŒ–

- âœ… å¤šé˜¶æ®µ Docker æ„å»ºï¼ˆå‡å°é•œåƒä½“ç§¯ï¼‰
- âœ… é root ç”¨æˆ·è¿è¡Œï¼ˆå®‰å…¨æ€§ï¼‰
- âœ… å¥åº·æ£€æŸ¥æ”¯æŒ
- âœ… æ„å»ºç¼“å­˜ä¼˜åŒ–

### âœ… éƒ¨ç½²ä¾¿åˆ©

- âœ… ä¸€é”®éƒ¨ç½²è„šæœ¬
- âœ… è‡ªåŠ¨åŒ–é…ç½®åŠ©æ‰‹
- âœ… è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†

## ğŸ”— ç›¸å…³é“¾æ¥

- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [DockerHub](https://hub.docker.com/)
- [Docker æœ€ä½³å®è·µ](https://docs.docker.com/develop/dev-best-practices/)
- [Next.js Docker éƒ¨ç½²](https://nextjs.org/docs/deployment#docker-image)

## ğŸ’¬ åé¦ˆ

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [å®Œæ•´éƒ¨ç½²æŒ‡å—](./DOCKER_DEPLOYMENT.md)
2. æŸ¥çœ‹ [å¿«é€Ÿå¼€å§‹æŒ‡å—](./QUICK_START.md)
3. æäº¤ Issue åˆ°é¡¹ç›®ä»“åº“

---

**æ–‡æ¡£åˆ›å»ºæ—¥æœŸ**: 2024å¹´11æœˆ28æ—¥
**æœ€åæ›´æ–°**: 2024å¹´11æœˆ28æ—¥
