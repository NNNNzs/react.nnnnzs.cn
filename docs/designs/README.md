# 功能设计文档

本目录存放项目的功能详细设计文档。

## 文档说明

设计文档与计划文档的区别：

- **设计文档** (`docs/designs/`): 长期参考的技术文档，描述架构和设计决策
- **计划文档** (`docs/plans/`): 临时性的实施方案，包含待办事项和验证清单
- **技术参考** (`docs/reference/`): 开发过程中的技术说明和调试指南

---

## 设计文档列表

### 向量检索与向量化

#### 向量检索系统
**文档**: [向量检索设计.md](./vector-search-design.md)
**描述**: 基于 Qdrant 的语义搜索系统设计
**内容**:
- 文章分块策略
- 嵌入模型选择
- 向量存储结构
- 检索算法和相关性排序

#### 向量化系统
**文档**: [向量化系统设计.md](./embedding-design.md)
**描述**: 文章向量化的完整实现方案
**内容**:
- 智能文本切片（Markdown 结构）
- 批量向量化流程
- 异步队列管理
- 错误重试机制
- Qdrant 集成

#### RAG 系统重构
**文档**: [RAG 系统重构：简化向量更新机制](./rag-system-refactor.md)
**描述**: 向量化系统的重构总结
**内容**:
- 从增量更新到全量更新
- 文本切片优化
- 异步队列集成
- 实施总结

---

### AI 对话系统

#### 聊天系统
**文档**: [AI 聊天系统设计.md](./chat-system-design.md)
**描述**: 基于 ReAct Agent 的 RAG 聊天机器人
**内容**:
- ReAct Agent 架构（Thought-Action-Observation）
- 工具调用机制（search_articles）
- SSE 流式响应
- 前端组件设计
- 对话历史管理

---

### 权限与认证

#### 权限系统
**文档**: [权限系统设计.md](./permission-design.md)
**描述**: 多层权限防护架构
**内容**:
- RBAC 权限模型（角色定义）
- 多层权限检查
- API 权限实现规范
- 通用权限工具

#### MCP OAuth 认证
**文档**: [MCP OAuth 2.0 认证设计.md](./mcp-oauth-design.md)
**描述**: MCP 服务 OAuth 2.0 集成
**内容**:
- OAuth 2.0 标准端点
- Bearer Token 认证
- 路由冲突解决
- Claude Code CLI 兼容

---

### 内容管理

#### 合集系统
**文档**: [博客合集功能设计.md](./collection-design.md)
**描述**: 文章合集管理功能
**内容**:
- 数据库设计（tb_collection 表）
- 合集 CRUD 操作
- 文章与合集关联
- 前端展示组件

---

### 基础设施

#### 队列系统
**文档**: [队列系统设计.md](./queue-design.md)
**描述**: 异步任务队列系统
**内容**:
- 内存队列实现
- 优先级调度
- 并发控制
- 错误重试机制
- 监控和调试

---

## 如何添加设计文档

### 1. 创建文档

从计划文档转换时：
1. 移除"实施步骤"和"验证清单"部分
2. 保留"问题分析"、"解决方案"、"技术细节"
3. 添加代码示例和架构图
4. 添加参考链接

### 2. 创建 Cursor 规则引用

在 `.cursor/rules/` 中创建对应规则，引用设计文档：

```markdown
---
description: "向量检索系统规范"
globs: ["src/services/embedding/**", "src/services/vector/**"]
alwaysApply: false
---

# 向量检索系统

详细设计文档：[向量检索设计](../../../docs/designs/vector-search-design.md)

## 关键规范
...
```

### 3. 更新本 README

在上方列表中添加新文档的索引。

---

## 文档模板

```markdown
# [功能名称] 设计文档

## 概述
简要描述功能和目标

## 架构设计
### 整体架构
架构图或流程图

### 核心组件
- 组件 1: 职责
- 组件 2: 职责

## 技术实现
### 数据结构
接口、类型、Schema 定义

### 关键流程
流程图和说明

### 代码示例
重要代码片段

## 使用指南
如何使用该功能

## 性能考虑
- 优化策略
- 潜在瓶颈
- 监控指标

## 安全考虑
- 安全措施
- 潜在风险

## 扩展性
- 未来改进方向
- 可扩展点

## 参考资料
- 相关链接
- 参考文档
```

---

## 维护原则

⚠️ **重要**：
- 设计文档应该随代码一起更新
- 代码变更时，同步更新相关设计文档
- 定期审查设计文档的准确性
- 移除过时的设计文档
