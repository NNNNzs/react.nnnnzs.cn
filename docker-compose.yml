version: '3.8'

services:
  react-nnnnzs-cn:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: react-nnnnzs-cn
    restart: unless-stopped
    ports:
      - "3301:3301"  # 宿主机端口:容器端口
    volumes:
      # 映射整个项目目录到容器
      - .:/app
      # 排除 node_modules，使用容器内的
      - /app/node_modules
      # 排除 .next 构建目录，使用容器内的
      - /app/.next
    # 直接加载 .env 文件
    env_file:
      - .env
    environment:
      # 覆盖或添加必要的环境变量
      - NODE_ENV=production
      - PORT=3301
      - FORCE_REBUILD=false  # 设置为 true 强制重新构建
    # 如果需要连接宿主机的 MySQL 和 Redis
    # 使用 host.docker.internal（Mac/Windows）或宿主机 IP（Linux）
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - react-nnnnzs-network

networks:
  react-nnnnzs-network:
    driver: bridge

