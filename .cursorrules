# 项目规则和约定

## 项目概述
这是一个基于 Next.js 16 的全栈博客项目，使用 TypeScript、TypeORM、Ant Design 和 Tailwind CSS 构建。

## 技术栈
- **框架**: Next.js 16.0.1 (App Router)
- **React**: 19.2.0
- **TypeScript**: 5.x (严格模式)
- **数据库**: MySQL (TypeORM 0.3.27)
- **UI 组件库**: Ant Design 6.0.0-alpha.3
- **样式**: Tailwind CSS 4
- **缓存**: Redis (ioredis)
- **云存储**: 腾讯云 COS
- **认证**: NextAuth 4.24.13
- **Markdown**: md-editor-rt, react-markdown
- ** 使用pnpm作为包管理器

## 代码规范

### TypeScript
- 使用严格模式 (`strict: true`)
- 启用装饰器和元数据 (`experimentalDecorators`, `emitDecoratorMetadata`)
- 使用路径别名 `@/*` 指向 `./src/*`
- 所有类型定义必须明确，避免使用 `any`

### 文件组织
- **路由**: `src/app/` - Next.js App Router 路由和页面
- **组件**: `src/components/` - 可复用的 React 组件
- **API 路由**: `src/app/api/` - Next.js API 路由处理程序
- **实体**: `src/entities/` - TypeORM 实体定义
- **DTO**: `src/dto/` - 数据传输对象和类型定义
- **工具库**: `src/lib/` - 工具函数、配置和数据库连接
- **上下文**: `src/contexts/` - React Context 提供者
- **类型**: `src/types/` - TypeScript 类型定义
- **文档**: `docs/` - 项目文档

### 组件规范
- 客户端组件必须使用 `'use client'` 指令
- 使用函数式组件和 Hooks
- 组件文件使用 PascalCase 命名
- 使用 JSDoc 注释描述组件功能
- 优先使用 Ant Design 组件，必要时使用 Tailwind CSS 自定义样式

### API 路由规范
- 使用 Next.js App Router 的 Route Handlers (`route.ts`)
- 所有 API 路由必须包含 JSDoc 注释说明功能
- 使用统一的响应格式 (`successResponse`, `errorResponse`)
- 错误处理必须包含适当的 HTTP 状态码
- 使用 TypeORM Repository 模式进行数据库操作

### 数据库规范
- 使用 TypeORM 实体定义数据模型
- 实体类使用装饰器 (`@Entity`, `@Column` 等)
- 使用 Repository 模式访问数据库
- 通过 `getDataSource()` 获取数据库连接
- 开发环境启用 `synchronize`，生产环境必须使用迁移

### 样式规范
- 优先使用 Tailwind CSS 工具类
- Ant Design 组件使用默认样式，通过 `ConfigProvider` 配置主题
- 支持暗色模式，使用 `dark:` 前缀
- 响应式设计使用 Tailwind 断点 (`md:`, `lg:` 等)

### 注释规范
- 所有函数、类、组件必须包含 JSDoc 注释
- 使用中文注释和文档
- 复杂逻辑必须添加行内注释说明
- API 路由必须在文件顶部注释说明路由路径和功能

### 命名规范
- **文件**: kebab-case (组件使用 PascalCase)
- **变量/函数**: camelCase
- **常量**: UPPER_SNAKE_CASE
- **类型/接口**: PascalCase
- **组件**: PascalCase

### 导入规范
- 按以下顺序组织导入：
  1. React 和 Next.js 核心
  2. 第三方库
  3. Ant Design 组件
  4. 项目内部模块 (`@/...`)
  5. 类型定义
  6. 样式文件
- 使用路径别名 `@/` 而不是相对路径

### 环境变量
- 数据库配置: `DB_HOST`, `DB_PORT`, `DB_USERNAME`, `DB_PASSWORD`, `DB_DATABASE`
- Redis 配置: `REDIS_HOST`, `REDIS_PORT`, `REDIS_PASSWORD`
- 认证配置: NextAuth 相关环境变量
- 云存储配置: 腾讯云 COS 相关配置

### 错误处理
- API 路由必须使用 try-catch 包裹异步操作
- 错误信息使用中文
- 开发环境输出详细错误堆栈
- 生产环境避免暴露敏感信息

### 性能优化
- 使用 Next.js 的 `Image` 组件优化图片
- 合理使用 `React.memo` 和 `useMemo`、`useCallback`
- 启用 React Compiler (`reactCompiler: true`)
- 使用 Next.js 的 `dynamic` 进行代码分割

### 部署相关
- 支持 Docker 部署 (`Dockerfile`, `docker-compose.yml`)
- 支持 PM2 进程管理 (`ecosystem.config.cjs`)
- 生产环境必须关闭数据库 `synchronize`

## 开发建议
- 新功能开发前先查看现有代码风格
- 遵循 Next.js App Router 最佳实践
- 保持代码简洁和可维护性
- 及时更新文档到 `docs/` 目录
- 提交前运行 ESLint 检查

## 注意事项
- 必须在所有使用 TypeORM 的文件顶部导入 `reflect-metadata`
- 客户端组件不能直接使用 TypeORM，需要通过 API 路由
- 注意 Next.js 16 和 React 19 的新特性和变化
- Ant Design 6.0.0-alpha.3 是 alpha 版本，注意 API 变化
